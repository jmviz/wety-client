(()=>{"use strict";const t=function(){switch(window.location.hostname){case"www.wety.org":case"wety.org":return"https://api.wety.org/";default:return"http://192.168.0.88:3000/"}}(),e=document.getElementById("tooltip");let n,i;function r(t,n,i){o(),function(t,n){var i,r;if(e.innerHTML="","fixed"===n){const t=document.createElement("button");t.textContent="✕",t.classList.add("close-button"),e.appendChild(t),t.addEventListener("pointerup",o)}const s=t.data.item,a=t.parent?{lang:t.parent.data.item.lang,term:t.parent.data.item.term,langDistance:t.parent.data.langDistance}:null,l=document.createElement("p");l.classList.add("lang"),l.style.color=qt(t.data.langDistance),l.textContent=`${s.lang}`,e.appendChild(l);const u=document.createElement("p");if(u.innerHTML=`<span class="term">${s.term}</span>`+(s.romanization?` <span class="romanization">(${s.romanization})</span>`:""),e.appendChild(u),s.imputed){const t=document.createElement("div");t.classList.add("pos-line"),t.innerHTML='<span class="imputed">(imputed)</span>',e.appendChild(t)}else if(s.pos&&s.gloss&&s.pos.length===s.gloss.length){const t=document.createElement("div"),n=null!==(i=s.pos)&&void 0!==i?i:[],o=null!==(r=s.gloss)&&void 0!==r?r:[];for(let e=0;e<n.length;e++){const i=n[e],r=o[e],s=document.createElement("div");s.classList.add("pos-line"),s.innerHTML=`<span class="pos">${i}</span>: <span class="gloss">${r}</span>`,t.appendChild(s)}e.appendChild(t)}if(s.etyMode&&a){const t=document.createElement("div");t.classList.add("ety-line");const n=function(t){switch(t){case"derived":case"undefined derivation":case"inherited":case"borrowed":case"back-formation":return"from";case"compound":case"univerbation":case"transfix":case"surface analysis":case"suffix":case"prefix":case"infix":case"confix":case"circumfix":case"blend":case"affix":return"with";case"vṛddhi":case"vṛddhi-ya":return"derivative of";case"root":return"reflex of";case"mention":return"in";default:return"of"}}(s.etyMode),i=qt(a.langDistance);t.innerHTML=`<span class="ety-mode">${s.etyMode}</span> <span class="ety-prep">${n}</span> <span class="parent-lang" style="color: ${i};">${a.lang}</span> <span class="parent-term">${a.term}</span>`,e.appendChild(t)}if(s.url){const t=document.createElement("div");t.classList.add("wiktionary-link-container");const n=document.createElement("a");n.textContent="Wiktionary",n.href=s.url,n.target="_blank",n.classList.add("wiktionary-link"),t.appendChild(n),e.appendChild(t)}}(t,i),function(t,n){"hover"===n?function(t){e.style.position="absolute";const n=e.getBoundingClientRect(),i=t.getBoundingClientRect();i.top>=n.height?e.style.top=i.top+window.scrollY-n.height+"px":e.style.top=i.bottom+window.scrollY+"px",i.left+n.width<=window.innerWidth?e.style.left=i.left+window.scrollX+"px":e.style.left=i.right+window.scrollX-n.width+"px"}(t):(e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)")}(n,i),e.style.zIndex="9000",e.style.opacity="1"}function o(){e.style.opacity="0",e.style.zIndex="-9000",e.innerHTML="",e.style.top="0px",e.style.left="0px"}function s(t,e){return t.parent===e.parent?1:2}function a(t,e){var n;return Math.min(t,null!==(n=e.x)&&void 0!==n?n:0)}function l(t,e){var n;return Math.max(t,null!==(n=e.y)&&void 0!==n?n:0)}e.addEventListener("pointerenter",(t=>{"mouse"===t.pointerType&&window.clearTimeout(n)})),e.addEventListener("pointerleave",(t=>{"mouse"===t.pointerType&&(window.clearTimeout(i),n=window.setTimeout(o,100))}));var u="http://www.w3.org/1999/xhtml";const c={svg:"http://www.w3.org/2000/svg",xhtml:u,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function h(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),c.hasOwnProperty(e)?{space:c[e],local:t}:t}function d(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===u&&e.documentElement.namespaceURI===u?e.createElement(t):e.createElementNS(n,t)}}function f(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function p(t){var e=h(t);return(e.local?f:d)(e)}function m(){}function g(t){return null==t?m:function(){return this.querySelector(t)}}function v(){return[]}function y(t){return function(e){return e.matches(t)}}var _=Array.prototype.find;function w(){return this.firstElementChild}var x=Array.prototype.filter;function L(){return Array.from(this.children)}function $(t){return new Array(t.length)}function E(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function A(t,e,n,i,r,o){for(var s,a=0,l=e.length,u=o.length;a<u;++a)(s=e[a])?(s.__data__=o[a],i[a]=s):n[a]=new E(t,o[a]);for(;a<l;++a)(s=e[a])&&(r[a]=s)}function I(t,e,n,i,r,o,s){var a,l,u,c=new Map,h=e.length,d=o.length,f=new Array(h);for(a=0;a<h;++a)(l=e[a])&&(f[a]=u=s.call(l,l.__data__,a,e)+"",c.has(u)?r[a]=l:c.set(u,l));for(a=0;a<d;++a)u=s.call(t,o[a],a,o)+"",(l=c.get(u))?(i[a]=l,l.__data__=o[a],c.delete(u)):n[a]=new E(t,o[a]);for(a=0;a<h;++a)(l=e[a])&&c.get(f[a])===l&&(r[a]=l)}function b(t){return t.__data__}function S(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function T(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function M(t){return function(){this.removeAttribute(t)}}function C(t){return function(){this.removeAttributeNS(t.space,t.local)}}function N(t,e){return function(){this.setAttribute(t,e)}}function k(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function B(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function D(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function H(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function z(t){return function(){this.style.removeProperty(t)}}function P(t,e,n){return function(){this.style.setProperty(t,e,n)}}function j(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function F(t){return function(){delete this[t]}}function R(t,e){return function(){this[t]=e}}function V(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function q(t){return t.trim().split(/^|\s+/)}function O(t){return t.classList||new U(t)}function U(t){this._node=t,this._names=q(t.getAttribute("class")||"")}function Q(t,e){for(var n=O(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function W(t,e){for(var n=O(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function X(t){return function(){Q(this,t)}}function K(t){return function(){W(this,t)}}function Y(t,e){return function(){(e.apply(this,arguments)?Q:W)(this,t)}}function Z(){this.textContent=""}function G(t){return function(){this.textContent=t}}function J(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function tt(){this.innerHTML=""}function et(t){return function(){this.innerHTML=t}}function nt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function it(){this.nextSibling&&this.parentNode.appendChild(this)}function rt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ot(){return null}function st(){var t=this.parentNode;t&&t.removeChild(this)}function at(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function lt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ut(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function ct(t,e,n){return function(){var i,r=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=e);this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function ht(t,e,n){var i=H(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function dt(t,e){return function(){return ht(this,t,e)}}function ft(t,e){return function(){return ht(this,t,e.apply(this,arguments))}}E.prototype={constructor:E,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},U.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var pt=[null];function mt(t,e){this._groups=t,this._parents=e}function gt(t){return function(t){return"string"==typeof t?new mt([[document.querySelector(t)]],[document.documentElement]):new mt([[t]],pt)}(p(t).call(document.documentElement))}mt.prototype=function(){return new mt([[document.documentElement]],pt)}.prototype={constructor:mt,select:function(t){"function"!=typeof t&&(t=g(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,s,a=e[r],l=a.length,u=i[r]=new Array(l),c=0;c<l;++c)(o=a[c])&&(s=t.call(o,o.__data__,c,a))&&("__data__"in o&&(s.__data__=o.__data__),u[c]=s);return new mt(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):function(t){return null==t?v:function(){return this.querySelectorAll(t)}}(t);for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var s,a=e[o],l=a.length,u=0;u<l;++u)(s=a[u])&&(i.push(t.call(s,s.__data__,u,a)),r.push(s));return new mt(i,r)},selectChild:function(t){return this.select(null==t?w:function(t){return function(){return _.call(this.children,t)}}("function"==typeof t?t:y(t)))},selectChildren:function(t){return this.selectAll(null==t?L:function(t){return function(){return x.call(this.children,t)}}("function"==typeof t?t:y(t)))},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,s=e[r],a=s.length,l=i[r]=[],u=0;u<a;++u)(o=s[u])&&t.call(o,o.__data__,u,s)&&l.push(o);return new mt(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,b);var n,i=e?I:A,r=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var s=o.length,a=new Array(s),l=new Array(s),u=new Array(s),c=0;c<s;++c){var h=r[c],d=o[c],f=d.length,p=S(t.call(h,h&&h.__data__,c,r)),m=p.length,g=l[c]=new Array(m),v=a[c]=new Array(m);i(h,d,g,v,u[c]=new Array(f),p,e);for(var y,_,w=0,x=0;w<m;++w)if(y=g[w]){for(w>=x&&(x=w+1);!(_=v[x])&&++x<m;);y._next=_||null}}return(a=new mt(a,r))._enter=l,a._exit=u,a},enter:function(){return new mt(this._enter||this._groups.map($),this._parents)},exit:function(){return new mt(this._exit||this._groups.map($),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,o=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,o=i.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var u,c=n[l],h=i[l],d=c.length,f=a[l]=new Array(d),p=0;p<d;++p)(u=c[p]||h[p])&&(f[p]=u);for(;l<r;++l)a[l]=n[l];return new mt(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,s=r[o];--o>=0;)(i=r[o])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=T);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var s,a=n[o],l=a.length,u=r[o]=new Array(l),c=0;c<l;++c)(s=a[c])&&(u[c]=s);u.sort(e)}return new mt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],s=0,a=o.length;s<a;++s)(r=o[s])&&t.call(r,r.__data__,s,o);return this},attr:function(t,e){var n=h(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?C:M:"function"==typeof e?n.local?D:B:n.local?k:N)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?z:"function"==typeof e?j:P)(t,e,null==n?"":n)):function(t,e){return t.style.getPropertyValue(e)||H(t).getComputedStyle(t,null).getPropertyValue(e)}(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?F:"function"==typeof e?V:R)(t,e)):this.node()[t]},classed:function(t,e){var n=q(t+"");if(arguments.length<2){for(var i=O(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?Y:e?X:K)(n,e))},text:function(t){return arguments.length?this.each(null==t?Z:("function"==typeof t?J:G)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?tt:("function"==typeof t?nt:et)(t)):this.node().innerHTML},raise:function(){return this.each(it)},lower:function(){return this.each(rt)},append:function(t){var e="function"==typeof t?t:p(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:p(t),i=null==e?ot:"function"==typeof e?e:g(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(st)},clone:function(t){return this.select(t?lt:at)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),s=o.length;if(!(arguments.length<2)){for(a=e?ct:ut,i=0;i<s;++i)this.each(a(o[i],e,n));return this}var a=this.node().__on;if(a)for(var l,u=0,c=a.length;u<c;++u)for(i=0,l=a[u];i<s;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?ft:dt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],o=0,s=r.length;o<s;++o)(i=r[o])&&(yield i)}};var vt=Array.prototype.slice;function yt(t){return function(){return t}}const _t=Math.PI,wt=2*_t,xt=1e-6,Lt=wt-xt;function $t(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}class Et{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?$t:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return $t;const n=10**e;return function(t){this._+=t[0];for(let e=1,i=t.length;e<i;++e)this._+=Math.round(arguments[e]*n)/n+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,n,i){this._append`Q${+t},${+e},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(t,e,n,i,r,o){this._append`C${+t},${+e},${+n},${+i},${this._x1=+r},${this._y1=+o}`}arcTo(t,e,n,i,r){if(t=+t,e=+e,n=+n,i=+i,(r=+r)<0)throw new Error(`negative radius: ${r}`);let o=this._x1,s=this._y1,a=n-t,l=i-e,u=o-t,c=s-e,h=u*u+c*c;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(h>xt)if(Math.abs(c*a-l*u)>xt&&r){let d=n-o,f=i-s,p=a*a+l*l,m=d*d+f*f,g=Math.sqrt(p),v=Math.sqrt(h),y=r*Math.tan((_t-Math.acos((p+h-m)/(2*g*v)))/2),_=y/v,w=y/g;Math.abs(_-1)>xt&&this._append`L${t+_*u},${e+_*c}`,this._append`A${r},${r},0,0,${+(c*d>u*f)},${this._x1=t+w*a},${this._y1=e+w*l}`}else this._append`L${this._x1=t},${this._y1=e}`}arc(t,e,n,i,r,o){if(t=+t,e=+e,o=!!o,(n=+n)<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(i),a=n*Math.sin(i),l=t+s,u=e+a,c=1^o,h=o?i-r:r-i;null===this._x1?this._append`M${l},${u}`:(Math.abs(this._x1-l)>xt||Math.abs(this._y1-u)>xt)&&this._append`L${l},${u}`,n&&(h<0&&(h=h%wt+wt),h>Lt?this._append`A${n},${n},0,1,${c},${t-s},${e-a}A${n},${n},0,1,${c},${this._x1=l},${this._y1=u}`:h>xt&&this._append`A${n},${n},0,${+(h>=_t)},${c},${this._x1=t+n*Math.cos(r)},${this._y1=e+n*Math.sin(r)}`)}rect(t,e,n,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}}function At(t){return t[0]}function It(t){return t[1]}function bt(t){return t.source}function St(t){return t.target}function Tt(t,e){this._context=t,this._t=e}function Mt(t){return new Tt(t,0)}function Ct(t){var e=0,n=t.children,i=n&&n.length;if(i)for(;--i>=0;)e+=n[i].value;else e=1;t.value=e}function Nt(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=Bt)):void 0===e&&(e=kt);for(var n,i,r,o,s,a=new zt(t),l=[a];n=l.pop();)if((r=e(n.data))&&(s=(r=Array.from(r)).length))for(n.children=r,o=s-1;o>=0;--o)l.push(i=r[o]=new zt(r[o])),i.parent=n,i.depth=n.depth+1;return a.eachBefore(Ht)}function kt(t){return t.children}function Bt(t){return Array.isArray(t)?t[1]:null}function Dt(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function Ht(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function zt(t){this.data=t,this.depth=this.height=0,this.parent=null}Et.prototype,Tt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}},zt.prototype=Nt.prototype={constructor:zt,count:function(){return this.eachAfter(Ct)},each:function(t,e){let n=-1;for(const i of this)t.call(e,i,++n,this);return this},eachAfter:function(t,e){for(var n,i,r,o=this,s=[o],a=[],l=-1;o=s.pop();)if(a.push(o),n=o.children)for(i=0,r=n.length;i<r;++i)s.push(n[i]);for(;o=a.pop();)t.call(e,o,++l,this);return this},eachBefore:function(t,e){for(var n,i,r=this,o=[r],s=-1;r=o.pop();)if(t.call(e,r,++s,this),n=r.children)for(i=n.length-1;i>=0;--i)o.push(n[i]);return this},find:function(t,e){let n=-1;for(const i of this)if(t.call(e,i,++n,this))return i},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,i=e.children,r=i&&i.length;--r>=0;)n+=i[r].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),r=null;for(t=n.pop(),e=i.pop();t===e;)r=t,t=n.pop(),e=i.pop();return r}(e,t),i=[e];e!==n;)e=e.parent,i.push(e);for(var r=i.length;t!==n;)i.splice(r,0,t),t=t.parent;return i},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return Nt(this).eachBefore(Dt)},[Symbol.iterator]:function*(){var t,e,n,i,r=this,o=[r];do{for(t=o.reverse(),o=[];r=t.pop();)if(yield r,e=r.children)for(n=0,i=e.length;n<i;++n)o.push(e[n])}while(o.length)}};const Pt=document.getElementById("ety");let jt=null;function Ft(){return e=this,u=void 0,h=function*(){try{const e=Yt.selectedId,u=Jt.selectedId,c=yield fetch(`${t}headProgenitorTree/${u}?lang=${e}`);jt=yield c.json(),console.log(jt),function(){if(Pt.innerHTML="",null===jt)return;const{svgElement:t,nodeSelection:e,nodeBackgroundSelection:u}=function(t){var e;const u=Nt(t,(t=>t.children)),c=u.find((t=>t.data.item.id===Jt.selectedId)),h=null!==(e=null==c?void 0:c.ancestors())&&void 0!==e?e:[];u.count().sort(((t,e)=>{var n,i;return+h.includes(t)-+h.includes(e)||t.height-e.height||(null!==(n=t.value)&&void 0!==n?n:0)-(null!==(i=e.value)&&void 0!==i?i:0)||2*+(t.data.item.term<e.data.item.term)-1}));const d=parseFloat(window.getComputedStyle(Pt).fontSize),f=10*d,p=d,m=Math.floor(.25*d),g=function(){let t=s,e=1,n=1,i=!1;function r(r){var o,s;let u,c=0;const h=r;h.eachAfter((function(e){const n=e.children;n?(e.x=function(t){return t.reduce(a,0)}(n),e.y=function(t){return 1+t.reduce(l,0)}(n)):(e.x=u?c-=t(e,u):0,e.y=0,u=e)}));const d=function(t){let e;for(;e=t.children;)t=e[0];return t}(h),f=function(t){let e;for(;e=t.children;)t=e[e.length-1];return t}(h),p=(null!==(o=d.x)&&void 0!==o?o:0)-t(d,f)/2,m=(null!==(s=f.x)&&void 0!==s?s:0)+t(f,d)/2;return h.eachAfter(i?function(t){var i,r,o,s;t.x=((null!==(i=t.x)&&void 0!==i?i:0)-(null!==(r=h.x)&&void 0!==r?r:0))*e,t.y=((null!==(o=h.y)&&void 0!==o?o:0)-(null!==(s=t.y)&&void 0!==s?s:0))*n}:function(t){var i,r;t.x=((null!==(i=t.x)&&void 0!==i?i:0)-p)/(m-p)*e,t.y=(1-(h.y?null!==(r=t.y)&&void 0!==r?r:0/h.y:1))*n})}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=t&&void 0!==t[0]?+t[0]:e,n=t&&void 0!==t[1]?+t[1]:n,r):i?[e,n]:null},r.nodeSize=function(t){return arguments.length?(i=!0,e=t&&void 0!==t[0]?+t[0]:e,n=t&&void 0!==t[1]?+t[1]:n,r):i?[e,n]:null},r}().nodeSize([p,f]).separation(((t,e)=>(t.parent,e.parent,m)))(u);let v=1/0,y=-v;g.each((t=>{t.x>y&&(y=t.x),t.x<v&&(v=t.x)}));const _=(u.height+1)*f,w=y-v+4*p,x=[-f/2,v-2*p,_,w],L=gt("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("xmlns:xhtml","http://www.w3.org/1999/xhtml").attr("viewBox",x).attr("width",_).attr("height",w).attr("style",`min-width: ${_}px; max-width: ${_}px; height: auto; height: intrinsic;`).attr("shape-rendering","crispEdges").attr("vector-effect","non-scaling-stroke").attr("text-anchor","middle").attr("text-rendering","optimizeLegibility").on("touchstart",(()=>{}));L.append("g").attr("fill","none").attr("stroke","#555").attr("stroke-opacity",1).attr("stroke-linecap","butt").attr("stroke-linejoin","miter").attr("stroke-width",1).selectAll("path").data(g.links()).join("path").attr("d",function(t){let e=bt,n=St,i=At,r=It,o=null,s=null,a=function(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(null==n)e=null;else{const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);e=t}return t},()=>new Et(e)}(l);function l(){let l;const u=vt.call(arguments),c=e.apply(this,u),h=n.apply(this,u);if(null==o&&(s=t(l=a())),s.lineStart(),u[0]=c,s.point(+i.apply(this,u),+r.apply(this,u)),u[0]=h,s.point(+i.apply(this,u),+r.apply(this,u)),s.lineEnd(),l)return s=null,l+""||null}return l.source=function(t){return arguments.length?(e=t,l):e},l.target=function(t){return arguments.length?(n=t,l):n},l.x=function(t){return arguments.length?(i="function"==typeof t?t:yt(+t),l):i},l.y=function(t){return arguments.length?(r="function"==typeof t?t:yt(+t),l):r},l.context=function(e){return arguments.length?(null==e?o=s=null:s=t(o=e),l):o},l}(Mt).x((t=>t.y)).y((t=>t.x)));const $=g.descendants().map((function(t){return{node:t,bbox:new DOMRect(0,0,0,0)}})),E=L.append("g").selectAll("rect").data($).join("rect").attr("fill","white"),A=L.append("g").selectAll("g").data($).join("g").attr("font-weight",(t=>t.node.data.item.id==Jt.selectedId?"bold":null)).attr("transform",(t=>`translate(${t.node.y},${t.node.x})`));return A.append("text").attr("class","lang").attr("y","-1em").attr("fill",(t=>qt(t.node.data.langDistance))).text((t=>t.node.data.item.lang)),A.append("text").attr("class","term").attr("y","0.25em").text((t=>t.node.data.item.term)),A.append("text").attr("class","romanization").attr("y","1.5em").text((t=>t.node.data.item.romanization?`(${t.node.data.item.romanization})`:"")),function(t){t.on("pointerup",(function(t,e){"mouse"!==t.pointerType&&r(e.node,this,"fixed")})),t.on("pointerenter",(function(t,e){"mouse"===t.pointerType&&(window.clearTimeout(n),i=window.setTimeout((()=>{r(e.node,this,"hover")}),100))})),t.on("pointerleave",(t=>{"mouse"===t.pointerType&&(window.clearTimeout(i),n=window.setTimeout(o,100))}))}(A),{svgElement:L.node(),nodeSelection:A,nodeBackgroundSelection:E}}(jt);var c;null!==t&&(t.setAttribute("id","tree"),t.style.opacity="0",Pt.appendChild(t),c=u,e.each((function(t){t.bbox=this.getBBox()})),c.attr("width",(t=>t.bbox.width+6)).attr("height",(t=>t.bbox.height+6)).attr("transform",(function(t){return`translate(${t.node.y-3},${t.node.x-3})`})).attr("x",(t=>t.bbox.x)).attr("y",(t=>t.bbox.y)),window.scrollTo(document.body.scrollWidth,0),t.style.opacity="1")}()}catch(t){console.error(t)}},new((c=void 0)||(c=Promise))((function(t,n){function i(t){try{o(h.next(t))}catch(t){n(t)}}function r(t){try{o(h.throw(t))}catch(t){n(t)}}function o(e){var n;e.done?t(e.value):(n=e.value,n instanceof c?n:new c((function(t){t(n)}))).then(i,r)}o((h=h.apply(e,u||[])).next())}));var e,u,c,h}const Rt=["#2F2E7A","#0B3577","#143867","#0D3D4D","#06412C","#004300","#224000","#493500","#672001","#740A16","#740549","#730138"],Vt="#696969";function qt(t){return null===t?Vt:t<0?Rt[0]:t>Rt.length?Rt[Rt.length-1]:Rt[t]}var Ot=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))};class Ut{constructor(t){this.element=document.getElementById(t)}getQueryValue(){return encodeURIComponent(this.element.value.trim().toLowerCase())}}class Qt{constructor(t){this.data=[],this.element=document.getElementById(t),this.elementHovered=!1,this.items=[],this.activeItemIndex=null,this.element.addEventListener("pointerover",(()=>{this.elementHovered=!0})),this.element.addEventListener("pointerout",(()=>{this.elementHovered=!1}))}addItem(t){this.element.appendChild(t),this.items.push(t)}hide(){this.element.classList.add("hidden")}show(){this.element.classList.remove("hidden")}clear(){this.element.innerHTML="",this.hide(),this.items=[],this.activeItemIndex=null}updateActiveItem(t){const e=null!==this.activeItemIndex?this.items[this.activeItemIndex]:null;null==e||e.classList.remove("highlighted"),this.activeItemIndex=t;const n=null!==this.activeItemIndex?this.items[this.activeItemIndex]:null;null==n||n.classList.add("highlighted")}adjustScroll(){const t=null!==this.activeItemIndex?this.items[this.activeItemIndex]:null;if(null===t)return;const e=t.getBoundingClientRect(),n=this.element.getBoundingClientRect();e.bottom>n.bottom?this.element.scrollTop+=e.bottom-n.bottom:e.top<n.top&&(this.element.scrollTop-=n.top-e.top)}}class Wt{constructor(t){this.selectedId=null,this.input=t.input,this.suggestionsList=t.suggestionsList,this.apiEndpoint=t.apiEndpoint,this.nextFocus=t.nextFocus,this.input.element.addEventListener("input",(()=>this.handleInput())),this.input.element.addEventListener("keydown",(t=>this.handleKeydown(t))),this.input.element.addEventListener("blur",(()=>this.handleBlur()))}handleInput(){this.selectedId=null,window.clearTimeout(this.apiEndpoint.timeout),this.apiEndpoint.timeout=window.setTimeout((()=>this.fetchSuggestions()),this.apiEndpoint.timeoutDuration)}handleKeydown(t){if(0===this.suggestionsList.data.length)return;const e=this.suggestionsList.data.length-1,n=this.suggestionsList.activeItemIndex;let i=null;switch(t.key){case"Escape":this.suggestionsList.hide();break;case"ArrowDown":t.preventDefault(),i=null===n||n>=e?0:n+1;break;case"ArrowUp":t.preventDefault(),i=null===n||n<=0?e:n-1;break;case"Enter":null!==n&&this.suggestionsList.data[n]&&this.setSelected(this.suggestionsList.data[n])}this.suggestionsList.updateActiveItem(i),this.suggestionsList.adjustScroll()}handleBlur(){const t="ontouchstart"in window,e=window.matchMedia("(pointer: fine)").matches;(t&&!e||this.suggestionsList.elementHovered)&&null===this.selectedId||this.suggestionsList.hide()}fetchSuggestions(){return Ot(this,void 0,void 0,(function*(){const t=this.input.getQueryValue();if(t)try{const e=yield this.apiEndpoint.fetch(t);console.log(e),this.suggestionsList.data=e,this.displaySuggestions()}catch(t){console.error(t)}else this.suggestionsList.clear()}))}displaySuggestions(){if(this.suggestionsList.clear(),0!==this.suggestionsList.data.length){for(let t=0;t<this.suggestionsList.data.length;t++){const e=this.suggestionsList.data[t],n=e.createListElement();n.classList.add("search-suggestion-item"),n.addEventListener("pointerup",(()=>{this.setSelected(e)})),n.addEventListener("pointerover",(()=>{this.suggestionsList.updateActiveItem(t)})),this.suggestionsList.addItem(n)}this.suggestionsList.show()}}setSelected(t){var e;this.input.element.value=t.inputValue(),this.selectedId=t.getId(),this.suggestionsList.hide(),null===(e=this.nextFocus)||void 0===e||e.focus()}}class Xt{constructor(t){this.code=t.code,this.id=t.id,this.items=t.items,this.name=t.name,this.similarity=t.similarity}getId(){return this.id}createListElement(){const t=document.createElement("li");return t.textContent=this.name,t}inputValue(){return this.name}}class Kt{constructor(){this.timeout=void 0,this.timeoutDuration=500}fetch(e){return Ot(this,void 0,void 0,(function*(){const n=yield fetch(`${t}langs/${e}`);return(yield n.json()).map((t=>new Xt(t)))}))}}const Yt=new class extends Wt{constructor(){super({input:new Ut("lang-search-input"),suggestionsList:new Qt("lang-search-suggestions"),apiEndpoint:new Kt,nextFocus:document.getElementById("item-search-input")}),this.lastLangName=null,this.lastLangId=null,this.getStoredLastLang()}getStoredLastLang(){var t;return Ot(this,void 0,void 0,(function*(){const e=window.localStorage.getItem("lastLangName"),n=parseInt(window.localStorage.getItem("lastLangId")||"");if(null===e||isNaN(n))this.input.element.focus();else try{console.log(`Checking that stored last term language with name ${e} and id ${n} is still valid...`);const i=yield this.apiEndpoint.fetch(e);console.log(i);const r=i[0];if(r.inputValue()===e&&r.getId()===n)return console.log("Check succeeded, using stored last lang."),this.setSelected(r),void(null===(t=this.nextFocus)||void 0===t||t.focus());throw new Error("invalid stored last lang")}catch(t){return this.input.element.value="",this.input.element.focus(),console.log("Check failed, clearing stored last lang. Probably the data was updated since your last visit."),this.lastLangName=null,this.lastLangId=null,window.localStorage.removeItem("lastLangName"),void window.localStorage.removeItem("lastLangId")}}))}setSelected(t){window.localStorage.setItem("lastLangName",t.inputValue()),window.localStorage.setItem("lastLangId",t.getId().toString()),super.setSelected(t)}};class Zt{constructor(t){this.distance=t.distance,this.item=t.item}getId(){return this.item.id}createListElement(){var t,e;const n=document.createElement("li"),i=document.createElement("div");i.classList.add("term-line"),i.innerHTML=this.item.term,n.appendChild(i);const r=null!==(t=this.item.pos)&&void 0!==t?t:[],o=null!==(e=this.item.gloss)&&void 0!==e?e:[];for(let t=0;t<r.length;t++){const e=r[t],i=o[t],s=document.createElement("div");s.classList.add("pos-line"),s.innerHTML=`<span class="pos">${e}</span>: <span class="gloss">${i}</span>`,n.appendChild(s)}return n}inputValue(){return this.item.term}}class Gt{constructor(){this.timeout=void 0,this.timeoutDuration=500}fetch(e){return Ot(this,void 0,void 0,(function*(){const n=Yt.selectedId;if(null===n)return console.log("No term language selected, not fetching items."),[];const i=yield fetch(`${t}items/${n}/${e}`);return(yield i.json()).map((t=>new Zt(t)))}))}}const Jt=new class extends Wt{constructor(){super({input:new Ut("item-search-input"),suggestionsList:new Qt("item-search-suggestions"),apiEndpoint:new Gt,nextFocus:null}),this.treeFetchTimeout=void 0,this.treeFetchTimeoutDuration=0}setSelected(t){super.setSelected(t),null!==Yt.selectedId?(window.clearTimeout(this.treeFetchTimeout),this.treeFetchTimeout=window.setTimeout(Ft,this.treeFetchTimeoutDuration)):console.log("No term language selected, not fetching tree.")}}})();